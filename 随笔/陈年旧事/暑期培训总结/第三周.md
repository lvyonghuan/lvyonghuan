这周的主要工作就是做p2p下载器了。去年还是前年突发奇想想要做种试试，但是根本没有下载速度，那时候就大概查了下，稍微有了点内网和公网的概念，但是这次一做算是把这两个概念又强化了一下。从服务端开始写，架构设计什么的基本上就是按自己的思路铺开。还是比较顺利，没有遇到特别堵思路的地方。

中间被并发问题卡了一次，这次算是比较深刻地意识到了并发读写冲突的问题。有一个goroutine和主线程共用的变量，主线程把这个变量作为退出for循环的条件，goroutine并发写。一开始没太注意并发写的问题，然后后来发现程序老是下着下着下不动了，检查一下下下来的切片数量又基本上是那么回事。卡了一上午没啥思路，以为是被http传输堵塞了，后来用监视去看，发现这个变量的数量老是少那么少那么几个，导致跳不出for循环。最后突然恍然大悟，给变量的写操作加上了锁，总算是解决了问题。（ps：其实上面还有个并发写的切片，一开始我只想起来给int加锁，最后发现切片也有并发写的问题

以前写过一次并发逻辑的东西，从B站获取弹幕，然后用一个select语句开一堆goroutine去过滤弹幕信息，不过那次没涉及到并发写的问题。今天看了下那项目的一些代码，基本上是全局变量满天飞，四月末写的东西，没三个月自己都看不下去了。不过四月末我自己都还质疑自己能不能把那东西给写出来，到底还是给写出来了。很多东西也是在那次尝试里学到的，比如用const去表示数字的含义，锁的一些操作，用http包调用api这些。

刚跟小项目的前端沟通了下，对面提了个很好的建议，干活去了。